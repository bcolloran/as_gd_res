Refer to the file `AGENTS.md` in the repo `https://github.com/bcolloran/agents_md` and all of the other files in that repo for coding guidelines for this project.

(list files via: `https://api.github.com/repos/bcolloran/agents_md/git/trees/main?recursive=1`. Note: in a VsCode session, just use the built-in fetch, not `curl` or a python script or some other crazy solution!) 

This repo must be accessed by the agent at the start of every task to ensure it has the latest coding standards and guidelines.

**If the agent is not able to access that repo for any reason (network issues, offline mode, etc.), it must immediately halt work on the task and report the issue to the user.**

# Coding Guidelines for as_gd_res

# New features and revised functionality 
When modifying Rust code, minimally new rust tests should be added to cover the new functionality. If the new functionality is complex, the agent should also consider adding integration tests in the Godot project to ensure that the Rust code interacts correctly with Godot.

# Testing

## Running Rust tests

The agent should always run `cargo test` in the workspace root to run all tests in the workspace, not just the tests in the current crate. Do not pass additional flags to `cargo test` unless specifically requested by the user.

## Running Godot integration tests

The repository includes an end to end test that verifies that various resource types can be extracted correctly by running a Godot scene that uses the Rust extension. The output printed to the console by the Rust code is compared against an expected output file. If the output matches the expected output, the test passes. In this case the final line of the output will be "Output matches expected.".

### Local session (VS Code or terminal, won't work in cloud sessions)

Set the `GODOT_BIN` environment variable to point to your local Godot binary, then run the test script `test_resource_extract_local.sh` located in the repository root. For example, in a bash terminal:

```bash
export GODOT_BIN=/home/bc/Desktop/Godot_v4.5.1-stable_linux.x86_64
bash test_resource_extract_local.sh 
```


### Updating end to end test
The output printed to the console by the Rust code in `test_scene.tscn` is generated by the `godot_print!` statements in `resource_test_rust/src/lib.rs`. Generally, the agent should not need to modify this code. However, for example, something like a new type is added to the types that can be extracted, the agent may need to modify `resource_test_rust/src/lib.rs` with additional `godot_print!` statements to ensure that the new type is extracted correctly.

### Updating expected output
If the output changes the agent may need to update the expected output file `expected_rust_print_output.txt`. In this case, the agent MUST review the output VERY CAREFULLY to ensure that the changes are intentional and correct. After updating the expected output, the agent should run the test script again to ensure that it passes with the new expected output.



# OpenAI Codex session
**this section only applies when the agent is running in an OpenAI Codex session**

## Verifying resource extraction output (end to end test)
The repository includes a helper script `codex_scripts/test_resource_extract.sh`
which runs `test_scene.tscn` headlessly and compares the printed output with
`expected_rust_print_output.txt`. The script automatically preloads the
extension's script classes by running the editor once in headless mode.
Run it after building the extension and setting `GODOT_BIN` to verify the
scene output:

1. Download Godot and set the `GODOT_BIN` environment variable. __TO GET THE CURRENT DOWNLOAD LINK, LOOK FOR THE LINK IN THE FILE `.github/workflows/resource_output_test.yml`__. That is the source of truth for the download link. With that in mind, the commands will look something like this (**but be sure to get the correct link from the file mentioned above, and use the correct corresponding file name!**):
   ```bash
   curl -L https://github.com/godotengine/godot-builds/releases/download/4.x.x-stable/Godot_v4.x.x-stable_linux.x86_64.zip -o godot.zip
   unzip godot.zip -d /usr/local/bin
   export GODOT_BIN=/usr/local/bin/Godot_v4.x.x-stable_linux.x86_64
   chmod +x "$GODOT_BIN"
   ```
- Ensure `xvfb-run` is available (install `xvfb` if necessary).

- Build the Rust extension so the `.gdextension` file can locate the library:
   ```bash
   cargo build
   ```

- run the test script:
```bash
./codex_scripts/test_resource_extract.sh
```
